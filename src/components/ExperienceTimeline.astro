---
import ExperienceCard, { type ExperienceData } from './ExperienceCard.astro';

const experiences: ExperienceData[] = [
  {
    company: 'Juniper Creates',
    role: 'Senior Software Engineer',
    startDate: 'May 2025',
    endDate: 'Jul 2025',
    phase: '1→N',
    description: 'Merchandise Platform-as-a-Service (PaaS). Reporting directly under the CTO, defining strategic roadmap with key stakeholders.',
    achievements: [
      'Implemented new storefront creation designs (React + TypeScript)',
      'Hardened backend endpoints (TypeScript + NodeJS) for PostgreSQL + DynamoDB',
      'Improved testing infrastructure (Jest) across the stack',
      'Defined roadmap for tech-debt and engineering excellence tasks',
    ],
    techStack: ['C#', 'C++', 'Java', 'Rust', 'React', 'TypeScript', 'Node.js', 'PostgreSQL', 'DynamoDB'],
  },
  {
    company: 'Meta | Reality Labs Research',
    role: 'Contingent Worker',
    startDate: 'Aug 2023',
    endDate: 'May 2025',
    phase: '0→1',
    description: 'Research Platform development. Architected full-stack applications across Web, Android, and backend microservices deployed to Meta infrastructure.',
    achievements: [
      'Launched full-stack Memory application from concept to production on facebook.com',
      'Enhanced annotations platform for ML model training (React, Relay, GraphQL, PHP, Python)',
      'Integrated Meta research hardware (Ray-Bans, Aria) via proprietary Android SDKs',
      'Weekly sprint demos to VPs; key member of Tiger Team for annual CTO innovation demos',
      'Provided technical mentorship to North American engineers and managed offshore vendor in India',
    ],
    techStack: ['React', 'Relay', 'GraphQL', 'PHP', 'Python', 'Rust', 'Thrift', 'Java', 'Kotlin', 'JNI', 'C++', 'Android'],
  },
  {
    company: 'd1g1t Inc.',
    role: 'Senior Software Engineer',
    startDate: 'Oct 2022',
    endDate: 'Aug 2023',
    phase: '1→N',
    description: 'Multi-tenant enterprise financial tech product. Wealth management platform serving advisors and investors with React mono-repo architecture.',
    achievements: [
      'Led major refactoring of table pagination algorithm (React) for 10,000+ records, improving performance by 10%',
      'Optimized Webpack configuration resolving caching issues, enhancing deployment speed',
      'Implemented Document Management system with approval workflow',
      'Integrated FutureVault API for secure document access',
      'Implemented Docusign integration ensuring compliance with policy agreements',
    ],
    techStack: ['React', 'Python', 'Django', 'Webpack', 'FutureVault API', 'Docusign'],
  },
  {
    company: 'RBC',
    role: 'Senior Software Engineer',
    startDate: 'Jun 2021',
    endDate: 'Oct 2022',
    phase: '0→1',
    description: 'Enterprise product serving 2 LOB\'s in RBC: Wealth Management and Personal & Consumer Banking.',
    achievements: [
      'Developed Angular mono-repo deployed via Jenkins to Pivotal Cloud Foundry',
      'Integrated Verified.Me (Interac Direct) for secure client data retrieval',
      'Enhanced security with RSA encrypted JWTs to sign URL parameters',
      'Designed NGINX proxy pods to validate JWT parameters and retrieve auth tokens',
      'Optimized Jenkins build pipelines, reducing Angular build times by 25%',
      'Co-hosted bi-weekly Technology Knowledge Shares (TKS) for 10+ developers',
    ],
    techStack: ['Angular', 'Jenkins', 'Pivotal Cloud Foundry', 'Apigee', 'NGINX', 'Verified.Me', 'JWT', 'RSA'],
  },
  {
    company: 'Microsoft',
    role: 'Software Engineer',
    startDate: 'Jun 2018',
    endDate: 'May 2021',
    phase: 'N→N+1',
    description: 'Multiple product teams across Microsoft 365 ecosystem including OneDrive Photos,PowerPoint Online, OneDrive Android, and Windows Photos UWP.',
    achievements: [
      'Implemented ItemScope (Redux-based) state management upgrade in OneDrive Photos (KnockoutJS → React migration)',
      'Developed reusable functional web components (JS/TS) deployed across Microsoft 365 services',
      'Designed Tags Feedback Modal feature from 0→1 improving user engagement',
      'Led Zero Query Search feature in OneDrive Android App Photos tab',
      'Resolved critical deadlock bug in Windows Photos UWP affecting 7,000+ devices (16M+ crashes biweekly)',
      'Upgraded internal OneDrive SDK and integrated web components into PowerPoint Online',
    ],
    techStack: ['React', 'JavaScript', 'TypeScript', 'KnockoutJS', 'Redux', 'C#', 'C++', 'Java', 'Kotlin', 'UWP'],
  },
];
---

<section id="experience" class="experience-section">
  <!-- Background gradient -->
  <div class="section-bg"></div>
  
  <div class="section-inner">
    <!-- Section Header -->
    <div class="section-header">
      <h2 class="section-title">Experience</h2>
      <p class="section-subtitle">7+ years building products across startups and enterprise</p>
    </div>

    <!-- Experience Cards Container with Timeline -->
    <div class="timeline-container">
      <!-- Timeline Line (Desktop) -->
      <div class="timeline-line"></div>
      
      <!-- Experience Cards -->
      <div class="cards-stack">
        {experiences.map((exp, index) => (
          <div class={`card-row ${index % 2 === 0 ? 'align-start' : 'align-end'}`}>
            <ExperienceCard {...exp} side={index % 2 === 0 ? 'left' : 'right'} />
          </div>
        ))}
      </div>
    </div>

  </div>
</section>

<script>
  // GSAP ScrollTrigger animations for experience cards
  import { gsap } from 'gsap';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  gsap.registerPlugin(ScrollTrigger);

  const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  if (!prefersReducedMotion) {
    // Animate experience cards on scroll
    const cards = document.querySelectorAll('.experience-card-content');
    
    cards.forEach((card, index) => {
      const side = index % 2 === 0 ? -100 : 100;
      
      gsap.fromTo(card,
        {
          opacity: 0,
          x: side,
          scale: 0.95,
        },
        {
          opacity: 1,
          x: 0,
          scale: 1,
          duration: 0.8,
          ease: 'power3.out',
          scrollTrigger: {
            trigger: card,
            start: 'top 80%',
            end: 'top 50%',
            toggleActions: 'play none none none',
          },
        }
      );
    });
  } else {
    // Instant appearance for reduced motion
    gsap.set('.experience-card-content', { opacity: 1 });
  }

  // Details arrow rotation
  const detailsElements = document.querySelectorAll('.internships-details');
  detailsElements.forEach((details) => {
    details.addEventListener('toggle', (e) => {
      const arrow = (e.target as HTMLDetailsElement).querySelector('.details-arrow') as HTMLElement;
      if (arrow) {
        if ((e.target as HTMLDetailsElement).open) {
          arrow.style.transform = 'rotate(180deg)';
        } else {
          arrow.style.transform = 'rotate(0deg)';
        }
      }
    });
  });
</script>

<style>
  .experience-section {
    padding: 6rem 1rem;
    position: relative;
    overflow: hidden;
  }

  @media (min-width: 640px) {
    .experience-section { padding: 6rem 1.5rem; }
  }

  @media (min-width: 1024px) {
    .experience-section { padding: 6rem 2rem; }
  }

  .section-bg {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to bottom,
      var(--color-space-black),
      oklch(from var(--color-space-navy) l c h / 0.3),
      var(--color-space-black)
    );
    pointer-events: none;
  }

  .section-inner {
    max-width: 72rem;
    margin: 0 auto;
    position: relative;
    z-index: 10;
  }

  .section-header {
    text-align: center;
    margin-bottom: 5rem;
  }

  .section-title {
    font-size: 2.25rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    color: var(--color-text-primary);
  }

  @media (min-width: 768px) {
    .section-title { font-size: 3rem; }
  }

  .section-subtitle {
    font-size: 1.25rem;
    color: var(--color-text-secondary);
    max-width: 42rem;
    margin: 0 auto;
  }

  .timeline-container {
    position: relative;
  }

  .timeline-line {
    display: none;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    width: 1px;
    height: 100%;
    top: 0;
    background: linear-gradient(
      to bottom,
      transparent,
      oklch(from var(--color-accent-blue) l c h / 0.5),
      transparent
    );
  }

  @media (min-width: 768px) {
    .timeline-line { display: block; }
  }

  .cards-stack {
    display: flex;
    flex-direction: column;
    gap: 3rem;
  }

  @media (min-width: 768px) {
    .cards-stack { gap: 4rem; }
  }

  .card-row {
    display: flex;
    width: 100%;
  }

  .card-row.align-start {
    justify-content: flex-start;
  }

  .card-row.align-end {
    justify-content: flex-end;
  }

  details[open] summary {
    color: var(--color-accent-cyan);
  }

  summary::marker {
    content: '';
  }

  summary::-webkit-details-marker {
    display: none;
  }
</style>
