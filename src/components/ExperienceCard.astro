---
import TechPill from './TechPill.astro';

export interface ExperienceData {
  company: string;
  role: string;
  startDate: string;
  endDate: string;
  phase: '0→1' | '1→N' | 'N→N+1';
  description: string;
  achievements: string[];
  techStack: string[];
  logo?: string;
}

interface Props extends ExperienceData {
  side: 'left' | 'right';
}

const { company, role, startDate, endDate, phase, description, achievements, techStack, side } = Astro.props;

const phaseClass = {
  '0→1': 'phase-start',
  '1→N': 'phase-growth',
  'N→N+1': 'phase-scale',
}[phase] ?? 'phase-start';
---

<div class={`experience-card ${side === 'left' ? 'card-left' : 'card-right'}`}>
  <!-- Timeline Dot (Desktop) -->
  <div class="timeline-dot"></div>

  <!-- Card Content -->
  <div class="experience-card-content glassmorphism">
    <div class="card-header">
      <div class="card-meta">
        <h3 class="card-company">{company}</h3>
        <p class="card-role">{role}</p>
        <p class="card-dates">{startDate} - {endDate}</p>
      </div>
      <span class={`phase-badge ${phaseClass}`}>{phase}</span>
    </div>

    <p class="card-description">{description}</p>

    {achievements && achievements.length > 0 && (
      <ul class="achievements-list">
        {achievements.map((achievement) => (
          <li class="achievement-item">
            <span class="achievement-bullet">▸</span>
            <span>{achievement}</span>
          </li>
        ))}
      </ul>
    )}

    <div class="tech-stack">
      {techStack.map((tech) => (
        <TechPill label={tech} />
      ))}
    </div>
  </div>
</div>

<style>
  .experience-card {
    position: relative;
    width: 100%;
  }

  @media (min-width: 768px) {
    .experience-card {
      width: calc(50% - 2rem);
    }
    .experience-card.card-left {
      padding-right: 2rem;
    }
    .experience-card.card-right {
      padding-left: 2rem;
    }
  }

  .timeline-dot {
    display: none;
    position: absolute;
    top: 2.5rem;
    width: 1rem;
    height: 1rem;
    border-radius: 9999px;
    background: var(--color-accent-blue);
    box-shadow:
      0 0 10px var(--color-accent-blue),
      0 0 20px var(--color-accent-blue);
    transition: all 300ms;
    z-index: 10;
  }

  @media (min-width: 768px) {
    .timeline-dot {
      display: block;
    }
    .card-left .timeline-dot {
      right: -2rem;
      transform: translateX(50%);
    }
    .card-right .timeline-dot {
      left: -2rem;
      transform: translateX(-50%);
    }
    .card-left:hover .timeline-dot {
      box-shadow:
        0 0 15px var(--color-accent-blue),
        0 0 30px var(--color-accent-blue),
        0 0 45px var(--color-accent-blue);
      transform: translateX(50%) scale(1.2);
    }
    .card-right:hover .timeline-dot {
      box-shadow:
        0 0 15px var(--color-accent-blue),
        0 0 30px var(--color-accent-blue),
        0 0 45px var(--color-accent-blue);
      transform: translateX(-50%) scale(1.2);
    }
  }

  .experience-card-content {
    padding: 2.5rem;
    border-radius: 0.5rem;
    border: 1px solid oklch(from var(--color-accent-blue) l c h / 0.2);
    opacity: 0;
    transition: all 300ms;
  }

  @media (min-width: 768px) {
    .experience-card-content {
      padding: 3rem;
    }
  }

  .experience-card-content:hover {
    border-color: oklch(from var(--color-accent-blue) l c h / 0.4);
  }

  .card-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 1rem;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .card-meta {
    flex: 1;
  }

  .card-company {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--color-text-primary);
    margin-bottom: 0.25rem;
  }

  .card-role {
    font-size: 1.125rem;
    color: var(--color-accent-blue);
    font-weight: 600;
  }

  .card-dates {
    font-size: 0.875rem;
    color: var(--color-text-muted);
  }

  .phase-badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 600;
    border: 1px solid transparent;
    flex-shrink: 0;
  }

  /* oklch green ≈ 120° hue */
  .phase-badge.phase-start {
    background: oklch(0.55 0.18 145 / 0.2);
    color: oklch(0.72 0.15 145);
    border-color: oklch(0.55 0.18 145 / 0.3);
  }

  /* oklch blue ≈ 240° hue */
  .phase-badge.phase-growth {
    background: oklch(0.55 0.20 240 / 0.2);
    color: oklch(0.70 0.18 240);
    border-color: oklch(0.55 0.20 240 / 0.3);
  }

  /* oklch purple ≈ 290° hue */
  .phase-badge.phase-scale {
    background: oklch(0.55 0.20 290 / 0.2);
    color: oklch(0.70 0.18 290);
    border-color: oklch(0.55 0.20 290 / 0.3);
  }

  .card-description {
    color: var(--color-text-secondary);
    margin-bottom: 1rem;
    line-height: 1.625;
  }

  .achievements-list {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }

  .achievement-item {
    color: var(--color-text-secondary);
    font-size: 0.875rem;
    display: flex;
    align-items: flex-start;
  }

  .achievement-bullet {
    color: var(--color-accent-cyan);
    margin-right: 0.5rem;
    flex-shrink: 0;
  }

  .tech-stack {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 1rem;
  }
</style>
